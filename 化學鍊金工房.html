<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>åŒ–å­¸äººéŠé‡‘è¡“å·¥ä»¿Â v6.0.5</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Noto Sans TC', sans-serif; }
  .card { transition: transform .15s, box-shadow .15s; }
  .card:hover { transform: translateY(-4px); box-shadow: 0 6px 12px rgba(0,0,0,.15); }
  .sel { box-shadow: 0 0 0 3px #f87171 inset !important; }
</style>
</head>
<body class="min-h-screen bg-gradient-to-br from-rose-100 via-indigo-100 to-sky-100 p-4">
  <div class="mx-auto max-w-7xl">
    <!-- é¦–åœ–æ©«å¹… -->
    <header class="mb-2 flex items-center gap-3">
      <img class="w-8 h-8 text-indigo-500" src="https://scientieic-american-media.s3.ap-northeast-1.amazonaws.com/posts/2025/04/fed370e3-048c-414d-9a56-8cc7ee8cb089.jpeg" />
      <h1 class="text-2xl font-bold text-slate-700">åŒ–å­¸äººéŠé‡‘è¡“å·¥ä»¿Â v6.0.5</h1>
    </header>
    <p class="text-sm text-slate-600 mb-4">å‹åˆ©æ¢ä»¶ï¼šå…ˆå®Œæˆ <strong>7Â å€‹åˆ†å­</strong> å³ç²å‹</p>

    <div id="info" class="mb-3 font-medium text-slate-700"></div>

    <div class="flex gap-2 mb-2">
      <button id="formBtn" class="px-4 py-2 rounded bg-emerald-500 text-white" disabled>åˆæˆ</button>
      <button id="discardBtn" class="px-4 py-2 rounded bg-rose-500 text-white" disabled>ä¸Ÿæ£„</button>
      <button id="endBtn" class="px-4 py-2 rounded bg-indigo-500 text-white" disabled>çµæŸå›åˆï¼ˆæŠ½ç‰Œï¼‰</button>
    </div>
    <!-- reset button åˆ†è¡Œé¡¯ç¤ºï¼Œé¿å…èª¤é» -->
    <div class="mb-6">
      <button id="resetBtn" class="px-4 py-2 rounded bg-slate-500 text-white">é‡æ–°é–‹å§‹</button>
    </div>

    <div class="grid grid-cols-2 gap-4 mb-6">
      <div>
        <h2 class="font-semibold text-slate-800">é‡‘å±¬æ‰‹ç‰Œ</h2>
        <div id="metalHand" class="flex flex-wrap gap-2"></div>
      </div>
      <div>
        <h2 class="font-semibold text-slate-800">éé‡‘å±¬æ‰‹ç‰Œ</h2>
        <div id="nonHand" class="flex flex-wrap gap-2"></div>
      </div>
    </div>
    <h3 class="text-sm text-slate-600 mb-2">å¯å®Œæˆåˆ†å­</h3>
    <ul id="hints" class="list-disc list-inside text-xs text-emerald-700 mb-6"></ul>
    <h2 class="font-semibold text-slate-800">ä½ çš„åˆ†å­</h2>
    <div id="playerMelds" class="flex flex-wrap gap-2 mb-6"></div>
    <h2 class="font-semibold text-slate-800">æƒ°æ€§æ°£é«”å€</h2>
    <div id="inertZone" class="flex flex-wrap gap-2 mb-6"></div>
        <h2 class="font-semibold text-slate-800">å°æ‰‹æ‰‹ç‰Œ (<span id="aiCnt">0</span>)</h2>
    <div id="aiHand" class="flex flex-wrap gap-2 mb-4"></div>

    <h2 class="font-semibold text-slate-800">é›»è…¦åˆ†å­â€¯(<span id="aiCnt">0</span>)</h2>
    <div id="aiMelds" class="flex flex-wrap gap-2"></div>
  </div>
  <script>
    /* ========= éŠæˆ²å¸¸é‡ ========= */
    const BASE = 4, START = 7, DRAW = 2, WIN = 7;
    const WEIGHTS = { H:6, O:4, C:4, N:2, He:1, Ne:1, Ar:1 };
    const METALS = new Set(['Li','Na','Be','Mg','Al']);

    /* ========= å…ƒç´ å®šç¾© ========= */
    const ELEMENTS = [
      {s:'H',n:'æ°«',v:1},{s:'Li',n:'é‹°',v:1},{s:'Be',n:'éˆ¹',v:2},{s:'B',n:'ç¡¼',v:3},
      {s:'C',n:'ç¢³',v:-4},{s:'N',n:'æ°®',v:-3},{s:'O',n:'æ°§',v:-2},{s:'F',n:'æ°Ÿ',v:-1},
      {s:'Ne',n:'æ°–',v:0},{s:'Na',n:'éˆ‰',v:1},{s:'Mg',n:'é‚',v:2},{s:'Al',n:'é‹',v:3},
      {s:'Si',n:'çŸ½',v:4},{s:'P',n:'ç£·',v:-3},{s:'S',n:'ç¡«',v:-2},{s:'Cl',n:'æ°¯',v:-1},
      {s:'Ar',n:'æ°¬',v:0}
    ].map(e=>({...e,isMetal:METALS.has(e.s)}));

    /* ========= åˆ†å­å®šç¾© (RAW ç‰‡æ®µç¤ºä¾‹) ========= */
    const GROUPS = { OH:{O:1,H:1} };
    const RAW = [
      {n:'æ°´',f:{H:2,O:1}},
      {n:'æ°¯åŒ–éˆ‰',f:{Na:1,Cl:1}},
      {n:'æ°§æ°£',f:{O:2}},
      {n:'æ°«æ°£',f:{H:2}},
      {n:'æ°®æ°£',f:{N:2}},
      {n:'æ°¯æ°£',f:{Cl:2}},
      {n:'ä¹™é…¸',f:{C:2,H:4,O:2}},
      {n:'æ°«åŒ–é‹°',f:{Li:1,H:1}},
      {n:'æ°«åŒ–éˆ‰',f:{Na:1,H:1}},
      {n:'æ°«åŒ–éˆ¹',f:{Be:1,H:2}},
      {n:'æ°«åŒ–é‚',f:{Mg:1,H:2}},
      {n:'æ°«åŒ–é‹',f:{Al:1,H:3}},
      {n:'ç”²çƒ·',f:{C:1,H:4}},
      {n:'æ°¨',f:{N:1,H:3}},
      {n:'ç£·åŒ–æ°«',f:{P:1,H:3}},
      {n:'ç¡«åŒ–æ°«',f:{H:2,S:1}},
      {n:'æ°ŸåŒ–æ°«',f:{H:1,F:1}},
      {n:'æ°¯åŒ–æ°«',f:{H:1,Cl:1}},
      {n:'æ°Ÿæ°«åŒ–æ°¬',f:{H:1,Ar:1,F:1}},
      {n:'æ°ŸåŒ–é‹°',f:{Li:1,F:1}},
      {n:'æ°¯åŒ–é‹°',f:{Li:1,Cl:1}},
      {n:'æ°ŸåŒ–éˆ‰',f:{Na:1,F:1}},
      {n:'æ°¯åŒ–éˆ‰',f:{Na:1,Cl:1}},
      {n:'æ°ŸåŒ–éˆ¹',f:{Be:1,F:2}},
      {n:'æ°¯åŒ–éˆ¹',f:{Be:1,Cl:2}},
      {n:'æ°ŸåŒ–é‚',f:{Mg:1,F:2}},
      {n:'æ°¯åŒ–é‚',f:{Mg:1,Cl:2}},
      {n:'æ°ŸåŒ–é‹',f:{Al:1,F:3}},
      {n:'æ°¯åŒ–é‹',f:{Al:1,Cl:3}},
      {n:'å››æ°ŸåŒ–çŸ½',f:{Si:1,F:4}},
      {n:'å››æ°¯åŒ–çŸ½',f:{Si:1,Cl:4}},
      {n:'ä¸‰æ°¯åŒ–ç£·',f:{P:1,Cl:3}},
      {n:'äº”æ°¯åŒ–ç£·',f:{P:1,Cl:5}},
      {n:'ä¸‰æ°ŸåŒ–ç£·',f:{P:1,F:3}},
      {n:'äº”æ°ŸåŒ–ç£·',f:{P:1,F:5}},
      {n:'ä¸‰æ°ŸåŒ–ç¡¼',f:{B:1,F:3}},
      {n:'ä¸‰æ°¯åŒ–ç¡¼',f:{B:1,Cl:3}},
      {n:'ä¸‰æ°ŸåŒ–æ°®',f:{N:1,F:3}},
      {n:'ä¸‰æ°ŸåŒ–æ°¯',f:{Cl:1,F:3}},
      {n:'äº”æ°ŸåŒ–æ°¯',f:{Cl:1,F:5}},
      {n:'æ°§åŒ–é‹°',f:{Li:2,O:1}},
      {n:'æ°§åŒ–éˆ‰',f:{Na:2,O:1}},
      {n:'æ°§åŒ–éˆ¹',f:{Be:1,O:1}},
      {n:'æ°§åŒ–é‚',f:{Mg:1,O:1}},
      {n:'æ°§åŒ–é‹',f:{Al:2,O:3}},
      {n:'ä¸‰æ°§åŒ–äºŒç¡¼',f:{B:2,O:3}},
      {n:'ä¸€æ°§åŒ–ç¢³',f:{C:1,O:1}},
      {n:'äºŒæ°§åŒ–ç¢³',f:{C:1,O:2}},
      {n:'ä¸€æ°§åŒ–äºŒæ°®',f:{N:2,O:1}},
      {n:'ä¸€æ°§åŒ–æ°®',f:{N:1,O:1}},
      {n:'äºŒæ°§åŒ–æ°®',f:{N:1,O:2}},
      {n:'ä¸‰æ°§åŒ–äºŒæ°®',f:{N:2,O:3}},
      {n:'å››æ°§åŒ–äºŒæ°®',f:{N:2,O:4}},
      {n:'äº”æ°§åŒ–äºŒæ°®',f:{N:2,O:5}},
      {n:'äºŒæ°§åŒ–çŸ½',f:{Si:1,O:2}},
      {n:'ä¸‰æ°§åŒ–äºŒç£·',f:{P:2,O:3}},
      {n:'äº”æ°§åŒ–äºŒç£·',f:{P:2,O:5}},
      {n:'äºŒæ°§åŒ–ç¡«',f:{S:1,O:2}},
      {n:'ä¸‰æ°§åŒ–ç¡«',f:{S:1,O:3}},
      {n:'ä¸€æ°§åŒ–äºŒæ°¯',f:{Cl:2,O:1}},
      {n:'äºŒæ°§åŒ–æ°¯',f:{Cl:1,O:2}},
      {n:'ç¡«åŒ–é‹°',f:{Li:2,S:1}},
      {n:'ç¡«åŒ–éˆ‰',f:{Na:2,S:1}},
      {n:'ç¡«åŒ–éˆ¹',f:{Be:1,S:1}},
      {n:'ç¡«åŒ–é‚',f:{Mg:1,S:1}},
      {n:'ç¡«åŒ–é‹',f:{Al:2,S:3}},
      {n:'ç¢³åŒ–çŸ½',f:{Si:1,C:1}},
      {n:'äºŒç¡«åŒ–çŸ½',f:{Si:1,S:2}},
      {n:'ç¢³åŒ–é‹',f:{Al:4,C:3}},
      {n:'ç¢³åŒ–ç¡¼',f:{B:4,C:1}},
      {n:'æ°®åŒ–ç¡¼',f:{B:1,N:1}},
      {n:'æ°®åŒ–é‹',f:{Al:1,N:1}},
      {n:'æ°®åŒ–é‹°',f:{Li:3,N:1}},
      {n:'æ°®åŒ–é‚',f:{Mg:3,N:2}},
      {n:'ä¹™çƒ¯',f:{C:2,H:4}},
      {n:'ä¹™ç‚”',f:{C:2,H:2}},
      {n:'ç”²é†‡',f:{C:1,H:4,O:1}},
      {n:'ç”²é†›',f:{C:1,H:2,O:1}},
      {n:'ä¹™é†›',f:{C:2,H:4,O:1}},
      {n:'ç”²é…¸',f:{C:1,H:2,O:2}},
      {n:'ä¹™è…ˆ',f:{C:2,H:3,N:1}},
      {n:'ç”²èƒº',f:{C:1,H:5,N:1}},
      {n:'æ°¯ä»¿',f:{C:1,H:1,Cl:3}},
      {n:'äºŒæ°¯ç”²çƒ·',f:{C:1,H:2,Cl:2}},
      {n:'æ°¯ç”²çƒ·',f:{C:1,H:3,Cl:1}},
      {n:'å…‰æ°£',f:{C:1,O:1,Cl:2}},
      {n:'ç¡«é…¸',f:{H:2,S:1,O:4}},
      {n:'äºç¡«é…¸',f:{H:2,S:1,O:3}},
      {n:'ç¢³é…¸',f:{H:2,C:1,O:3}},
      {n:'ç¡é…¸',f:{H:1,N:1,O:3}},
      {n:'äºç¡é…¸',f:{H:1,N:1,O:2}},
      {n:'äºç£·é…¸',f:{H:3,P:1,O:3}},
      {n:'æ¬¡ç£·é…¸',f:{H:3,P:1,O:2}},
      {n:'é«˜æ°¯é…¸',f:{H:1,Cl:1,O:4}},
      {n:'æ°¯é…¸',f:{H:1,Cl:1,O:3}},
      {n:'äºæ°¯é…¸',f:{H:1,Cl:1,O:2}},
      {n:'æ¬¡æ°¯é…¸',f:{H:1,Cl:1,O:1}},
      {n:'æ°«æ°°é…¸',f:{H:1,C:1,N:1}},
      {n:'ç•°æ°°é…¸',f:{H:1,N:1,C:1,O:1}},
      {n:'ç¡«æ°°é…¸',f:{H:1,S:1,C:1,N:1}},
      {n:'ç–Šæ°®é…¸',f:{H:1,N:3}},
      {n:'ç¡«ä»£ç¡«é…¸',f:{H:2,S:2,O:3}},
      {n:'æ°«æ°§åŒ–é‹°',f:{Li:1,O:1,H:1}},
      {n:'æ°«æ°§åŒ–éˆ‰',f:{Na:1,O:1,H:1}},
      {n:'æ°«æ°§åŒ–é‚',f:{Mg:1,O:2,H:2}},
      {n:'æ°«æ°§åŒ–é‹',f:{Al:1,O:3,H:3}},
      {n:'æ°«æ°§åŒ–éŠ¨',f:{N:1,H:5,O:1}},
      {n:'æ°¯åŒ–éŠ¨',f:{N:1,H:4,Cl:1}},
      {n:'æ°ŸåŒ–éŠ¨',f:{N:1,H:4,F:1}},
      {n:'ç¢³é…¸é‹°',f:{Li:2,C:1,O:3}},
      {n:'ç¢³é…¸éˆ‰',f:{Na:2,C:1,O:3}},
      {n:'ç¢³é…¸æ°«éˆ‰',f:{Na:1,H:1,C:1,O:3}}
    ];

    /* ========= å·¥å…·å‡½å¼ ========= */
    const expand = f => { const r={}; for(const k in f){ if(k==='isIon')continue; if(GROUPS[k])for(const e in GROUPS[k])r[e]=(r[e]||0)+GROUPS[k][e]*f[k]; else r[k]=(r[k]||0)+f[k]; } return r; };
    const M = RAW.map(x=>({name:x.n,isIon:x.f.isIon||false,formula:expand(x.f)}));
    const key = cnt=>Object.keys(cnt).sort().map(k=>k+cnt[k]).join('');
    const MAP = new Map(M.map(m=>[key(m.formula),m]));

    /* ========= ç‰Œå †å»ºç«‹ ========= */
    const deck=[]; for(const el of ELEMENTS){ const c=Math.max(1,Math.round(BASE*(WEIGHTS[el.s]||1))); for(let i=0;i<c;i++)deck.push({...el,id:crypto.randomUUID()}); }
    for(let i=deck.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[deck[i],deck[j]]=[deck[j],deck[i]];}

    /* ========= éŠæˆ²ç‹€æ…‹ ========= */
    let round=1,turn='human';
    const mh=[],nh=[],ai=[],pm=[],am=[],inert=[],sel=new Set();

    /* ========= DOM å¿«æ· ========= */
    const $=id=>document.getElementById(id);
    const aiHand = $('aiHand'); // å°æ‰‹æ‰‹ç‰Œå®¹å™¨

    const metalEl=$('metalHand'),nonEl=$('nonHand'),hints=$('hints'),infoEl=$('info'),aiCnt=$('aiCnt');
    const pMeld=$('playerMelds'),aMeld=$('aiMelds');
    const btnF=$('formBtn'),btnD=$('discardBtn'),btnE=$('endBtn'),btnR=$('resetBtn');

    /* ========= æŠ½ç‰Œ ========= */
    const drawPlayer=()=>{const c=deck.pop();if(c)(c.isMetal?mh:nh).push(c);};
    for(let i=0;i<START;i++){drawPlayer();ai.push(deck.pop());}

    /* ========= å·¥å…· ========= */
    const cntArr=a=>a.reduce((o,c)=>(o[c.s]=(o[c.s]||0)+1,o),{});
    const cardElem=c=>{const d=document.createElement('div');d.className='card w-20 h-28 border flex flex-col items-center justify-center text-xs';if(sel.has(c.id))d.classList.add('sel');d.innerHTML=`<span class='text-lg font-bold'>${c.s}</span><span>${c.n}</span><span>${c.v>0?'+':''}${c.v}</span>`;d.onclick=()=>{if(turn!=='human')return;sel.has(c.id)?sel.delete(c.id):sel.add(c.id);render();};return d;};
    const molElem=n=>{const d=document.createElement('div');d.className='card w-20 h-16 bg-emerald-100 border border-emerald-400 flex items-center justify-center text-xs font-medium';d.textContent=n;return d;};

    /* ========= ä¸»æ¸²æŸ“ ========= */
    function render(){
      infoEl.textContent=`å›åˆ ${round} | ç‰Œå † ${deck.length}`;
      aiCnt.textContent=ai.length;
      // æˆ‘æ–¹æ‰‹ç‰Œ
      metalEl.innerHTML=nonEl.innerHTML='';
      mh.forEach(c=>metalEl.appendChild(cardElem(c)));
      nh.forEach(c=>nonEl.appendChild(cardElem(c)));
      // é¡¯ç¤ºå°æ‰‹æ‰‹ç‰Œï¼ˆæ­£é¢ï¼‰
      aiHand.innerHTML='';
      ai.forEach(c=>aiHand.appendChild(cardElem(c)));
      // æˆ‘æ–¹èˆ‡AIå·²æˆåˆ†å­
      pMeld.innerHTML=''; pm.forEach(m=>pMeld.appendChild(molElem(m.name)));
      aMeld.innerHTML=''; am.forEach(m=>aMeld.appendChild(molElem(m.name)));
      // æç¤º
      hints.innerHTML=''; const my=cntArr([...mh,...nh]);
      for(const m of M){
        if(Object.keys(m.formula).every(e=>my[e]>=m.formula[e])){
          const li=document.createElement('li'); li.textContent=m.name; hints.appendChild(li);
          if(hints.childElementCount>=3) break;
        }
      }
      btnF.disabled=btnD.disabled=sel.size===0||turn!=='human';btnE.disabled=turn!=='human';}

    /* ========= ç©å®¶æ“ä½œ ========= */
    function discard(){sel.forEach(id=>{const pool=mh.find(c=>c.id===id)?mh:nh;const idx=pool.findIndex(c=>c.id===id);const card=pool.splice(idx,1)[0];if(['He','Ne','Ar'].includes(card.s))inert.push(card);});sel.clear();render();}
    function form(){const chosen=[...mh,...nh].filter(c=>sel.has(c.id));const mk=key(cntArr(chosen));const mol=MAP.get(mk);sel.clear();if(!mol){render();return;}chosen.forEach(c=>{const pool=mh.includes(c)?mh:nh;pool.splice(pool.indexOf(c),1);});mol.isIon?nh.push({s:mol.name,n:mol.name,v:-1,isMetal:false,id:crypto.randomUUID()}):pm.push(mol);render();if(pm.length>=WIN){alert('ğŸ‰ ä½ è´äº†!');location.reload();}}

    /* ========= AI ========= */
    function aiTurn(){for(let i=0;i<DRAW;i++)ai.push(deck.pop());let progress=true;while(progress){progress=false;const aCnt=cntArr(ai);for(const m of M){if(m.isIon)continue;if(Object.keys(m.formula).every(e=>aCnt[e]>=m.formula[e])){for(const e in m.formula){let n=m.formula[e];for(let i=ai.length-1;i>=0&&n>0;i--)if(ai[i].s===e){ai.splice(i,1);n--;}}am.push(m);progress=true;break;}}if(am.length>=WIN){alert('ğŸ˜µ AI è´äº†');location.reload();return;}}turn='human';round++;drawPlayer();drawPlayer();render();}

    /* ========= äº‹ä»¶ ========= */
    btnF.onclick=form;btnD.onclick=discard;btnE.onclick=()=>{turn='ai';render();setTimeout(aiTurn,200);};btnR.onclick=()=>location.reload();

    render();
  </script>
</body>
</html>
