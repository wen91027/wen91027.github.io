<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>化學卡牌對戰遊戲</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400&display=swap" rel="stylesheet" />
  <style>
    body { margin:0; background:#0d1321; color:#fff; font-family:'Orbitron',sans-serif; text-align:center; }
    h1 { margin:0.5em 0; }
    .game-container { display:flex; flex-direction:column; align-items:center; padding:1em; }
    .board { width:90%; max-width:800px; background:#1a242f; border:2px solid #444; border-radius:10px; padding:1em; position:relative; }
    .overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000; }
    .overlay button { margin-top:1em; }
    .hp-section { display:flex; align-items:center; justify-content:center; margin:8px 0; }
    .hp-label { margin-right:8px; }
    .hp-bar { flex:1; background:#222; border:1px solid #0ff; border-radius:4px; height:16px; margin:0 8px; overflow:hidden; }
    .hp-inner { background:#0ff; height:100%; }
    .zone { margin:12px 0; }
    .zone-title { color:#ccc; margin-bottom:4px; }
    .hand, .field { display:flex; flex-wrap:wrap; justify-content:center; }
    .card { border:1px solid #555; border-radius:6px; padding:6px; margin:4px; transition:transform .2s; }
    .card:hover { transform:translateY(-4px); }
    .card.element { width:50px; height:70px; background:#1f2a36; cursor:pointer; position:relative; }
    .card.element.selected { border-color:#0f0; box-shadow:0 0 6px #0f0; }
    .card.molecule { width:80px; min-height:60px; background:#14232e; cursor:default; }
    .controls { margin:8px 0; }
    button { font-family:'Orbitron',sans-serif; background:#112233; color:#0ff; border:1px solid #0ff; border-radius:4px; padding:6px 12px; margin:0 4px; cursor:pointer; transition:background 0.2s; }
    button:hover:enabled { background:#334455; }
    button:disabled { opacity:0.5; cursor:not-allowed; }
    .prompt { color:#8cf; margin-top:4px; }
    .log { text-align:left; max-height:120px; overflow-y:auto; background:#112233; padding:8px; border:1px solid #333; border-radius:4px; margin-top:8px; font-size:0.85em; }
  </style>
</head>
<body>
<div id="root"></div>
<script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
<script type="text/babel">
const MAX_HP = 128;
const ELEMENTS=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca"];
const WEIGHTS={H:6,C:4,O:4,N:3,Na:3,He:0.5,Ne:0.5,Ar:0.5};
const drawPool=[];
ELEMENTS.forEach(e=>{const w=WEIGHTS[e]||1;const cnt=Math.round(w*2);for(let i=0;i<cnt;i++)drawPool.push(e);});
function drawCard(){return{el:drawPool[Math.floor(Math.random()*drawPool.length)],corroded:false};}
const MOLECULES=[
 { name: "水", formula: { H: 2, O: 1 }, effect: "none" },
 { name: "氯化鈉", formula: { Na: 1, Cl: 1 }, effect: "none" },
  { name: "鹽酸", formula: { H: 1, Cl: 1 }, effect: "corrosion" },
  { name: "硫酸", formula: { H: 2, S: 1, O: 4 }, effect: "corrosion" },
  { name: "硝酸", formula: { H: 1, N: 1, O: 3 }, effect: "corrosion" },
  { name: "氫氧化鈉", formula: { Na: 1, O: 1, H: 1 }, effect: "corrosion" },
  { name: "光氣", formula: { C: 1, O: 1, Cl: 2 }, effect: "poison" },
  { name: "氯仿", formula: { C: 1, H: 1, Cl: 3 }, effect: "poison" },
  { name: "甲烷", formula: { C: 1, H: 4 }, effect: "burn" },
  { name: "乙炔", formula: { C: 2, H: 2 }, effect: "burn" },
  { name: "乙烯", formula: { C: 2, H: 4 }, effect: "burn" },
{ name: "氮氣", formula: { N: 2 }, effect: "none" },
{ name: "氧氣", formula: { O: 2 }, effect: "none" },
{ name: "臭氧", formula: { O: 3 }, effect: "poison" },
{ name: "氫氣", formula: { H: 2 }, effect: "none" },
{ name: "氯氣", formula: { Cl: 2 }, effect: "poison" },
{ name: "氫氟酸", formula: { H: 1, F: 1 }, effect: "corrosion" },
{ name: "一氧化碳", formula: { C: 1, O: 1 }, effect: "poison" },
{ name: "二氧化碳", formula: { C: 1, O: 2 }, effect: "none" },
{ name: "一氧化氮", formula: { N: 2, O: 1 }, effect: "poison" },
{ name: "碳化矽", formula: { C: 1, Si: 1 }, effect: "poison" },

{ name: "氧化鈣", formula: { Ca: 1, O: 1 }, effect: "none" },
  { name: "氟化鈉", formula: { Na: 1, F: 1 }, effect: "none" },
  { name: "溴化鈉", formula: { Na: 1, Br: 1 }, effect: "none" },
  { name: "碘化鈉", formula: { Na: 1, I: 1 }, effect: "none" },
  { name: "硫化鈉", formula: { Na: 2, S: 1 }, effect: "none" },
  { name: "氧化鈉", formula: { Na: 2, O: 1 }, effect: "none" },
  { name: "氮化鈉", formula: { Na: 3, N: 1 }, effect: "none" },
  { name: "磷化鈉", formula: { Na: 3, P: 1 }, effect: "none" },
  { name: "氯化鋰", formula: { Li: 1, Cl: 1 }, effect: "none" },
  { name: "氟化鋰", formula: { Li: 1, F: 1 }, effect: "none" },
  { name: "溴化鋰", formula: { Li: 1, Br: 1 }, effect: "none" },
  { name: "硫化鋰", formula: { Li: 2, S: 1 }, effect: "none" },
  { name: "氧化鋰", formula: { Li: 2, O: 1 }, effect: "none" },
  { name: "氮化鋰", formula: { Li: 3, N: 1 }, effect: "none" },
  { name: "磷化鋰", formula: { Li: 3, P: 1 }, effect: "none" },
  { name: "氯化鉀", formula: { K: 1, Cl: 1 }, effect: "none" },
  { name: "氟化鉀", formula: { K: 1, F: 1 }, effect: "none" },
  { name: "溴化鉀", formula: { K: 1, Br: 1 }, effect: "none" },
  { name: "碘化鉀", formula: { K: 1, I: 1 }, effect: "none" },
  { name: "硫化鉀", formula: { K: 2, S: 1 }, effect: "none" },
  { name: "氧化鉀", formula: { K: 2, O: 1 }, effect: "none" },
  { name: "氮化鉀", formula: { K: 3, N: 1 }, effect: "none" },
  { name: "磷化鉀", formula: { K: 3, P: 1 }, effect: "none" },
  { name: "氯化鎂", formula: { Mg: 1, Cl: 2 }, effect: "none" },
  { name: "氟化鎂", formula: { Mg: 1, F: 2 }, effect: "none" },
  { name: "溴化鎂", formula: { Mg: 1, Br: 2 }, effect: "none" },
  { name: "氧化鎂", formula: { Mg: 1, O: 1 }, effect: "none" },
  { name: "硫化鎂", formula: { Mg: 1, S: 1 }, effect: "none" },
  { name: "氯化鈹", formula: { Be: 1, Cl: 2 }, effect: "none" },
  { name: "氟化鈹", formula: { Be: 1, F: 2 }, effect: "none" },
  { name: "氧化鈹", formula: { Be: 1, O: 1 }, effect: "none" },
  { name: "硫化鈹", formula: { Be: 1, S: 1 }, effect: "none" },
  { name: "氯化鋁", formula: { Al: 1, Cl: 3 }, effect: "none" },
  { name: "氟化鋁", formula: { Al: 1,F: 3 }, effect: "none" },
  { name: "氧化鋁", formula: { Al: 2, O: 3 }, effect: "none" },
  { name: "硫化鋁", formula: { Al: 2, S: 3 }, effect: "none" },
  { name: "氮化鋁", formula: { Al: 1, N: 1 }, effect: "none" },
  { name: "磷化鋁", formula: { Al: 1, P: 1 }, effect: "none" },

  { name: "氫氧化鋰", formula: { Li: 1, O: 1, H: 1 }, effect: "corrosion" },
  { name: "氫氧化鉀", formula: { K: 1, O: 1, H: 1 }, effect: "corrosion" },
  { name: "氫氧化鈣", formula: { Ca: 1, O: 2, H: 2 }, effect: "corrosion" },
  { name: "氫氧化鎂", formula: { Mg: 1, O: 2, H: 2 }, effect: "none" },
  { name: "氫氧化鋁", formula: { Al: 1, O: 3, H: 3 }, effect: "none" }

  // ... other molecules ...
];
function findMolecule(sel){const cnt={};sel.forEach(c=>{if(c&&c.el)cnt[c.el]=(cnt[c.el]||0)+1;});for(const m of MOLECULES){const f=m.formula;const total=Object.values(f).reduce((s,n)=>s+n,0);if(total!==sel.length)continue;let ok=true;for(const k in f)if(cnt[k]!==f[k])ok=false;for(const k in cnt)if(!f[k])ok=false;if(ok)return m;}return null;}
function App(){
  const [turn,setTurn]=React.useState('player');
  const firstTurn=React.useRef(true);
  const [pHP,setP]=React.useState(MAX_HP);
  const [aHP,setA]=React.useState(MAX_HP);
  const [pHand,setPH]=React.useState([]);
  const [aHand,setAH]=React.useState([]);
  const [pField,setPF]=React.useState([]);
  const [aField,setAF]=React.useState([]);
  const [sel,setSel]=React.useState([]);
  const [log,setLog]=React.useState([]);
  const [gameOver,setGameOver]=React.useState(null);
  const addLog=msg=>setLog(l=>[msg,...l]);

  const resetGame=()=>{
    setP(MAX_HP);setA(MAX_HP);
    setPH(Array.from({length:5},drawCard));
    setAH(Array.from({length:5},drawCard));
    setPF([]);setAF([]);setSel([]);setLog([]);
    setTurn('player');firstTurn.current=true;setGameOver(null);
  };

  React.useEffect(()=>{resetGame();},[]);
  React.useEffect(()=>{if(gameOver)return;if(pHP<=0)setGameOver('lose');else if(aHP<=0)setGameOver('win');},[pHP,aHP]);
  React.useEffect(()=>{if(gameOver)return;if(firstTurn.current){firstTurn.current=false;return;}if(turn==='player'){setPH(h=>[...h,drawCard(),drawCard()]);addLog('玩家抽2張');}else{setAH(h=>[...h,drawCard(),drawCard()]);addLog('AI抽2張');}},[turn]);

  const endTurn=()=>{if(gameOver)return;addLog('結束回合');setSel([]);setTurn(t=>t==='player'?'ai':'player');};
  const onSelect=i=>{if(gameOver||turn!=='player')return;setSel(s=>s.includes(i)?s.filter(x=>x!==i):[...s,i]);};
  const combine=()=>{if(gameOver||turn!=='player')return;if(sel.length<2){addLog('請選2張');return;}const cards=sel.map(i=>pHand[i]);if(cards.some(c=>!c||c.corroded)){addLog('腐蝕卡無法合成');return;}const m=findMolecule(cards);if(!m){addLog('無效配方');return;}setPF(f=>[m,...f]);setPH(h=>h.filter((_,i)=>!sel.includes(i)));addLog(`合成${m.name}`);const dmg=sel.reduce((s,i)=>(s+(pHand[i]?ELEMENTS.indexOf(pHand[i].el)+1:0)),0);setA(h=>Math.max(0,h-dmg));addLog(`對手受${dmg}傷`);setSel([]);};
  const discard=()=>{if(gameOver||turn!=='player')return;if(sel.length<1){addLog('選擇棄牌');return;}if(sel.length>3){addLog('最多3張');return;}const names=sel.map(i=>pHand[i]?pHand[i].el:'').join(',');setPH(h=>h.filter((_,i)=>!sel.includes(i)));addLog(`棄牌:${names}`);setSel([]);endTurn();};
  React.useEffect(()=>{if(gameOver||turn!=='ai')return;setTimeout(()=>{const possibleAI=[];MOLECULES.forEach(m=>{let ok=true;Object.entries(m.formula).forEach(([el,c])=>{if(aHand.filter(x=>x.el===el).length<c)ok=false;});if(ok)possibleAI.push(m);});if(possibleAI.length>0&&Math.random()<0.5){const m=possibleAI[0];let used=[];const tmp={};setAH(h=>{const nh=[...h];for(let i=nh.length-1;i>=0;i--){const c=nh[i];if(c&&m.formula[c.el]&&(tmp[c.el]||0)<m.formula[c.el]){used.push(c.el);tmp[c.el]=(tmp[c.el]||0)+1;nh.splice(i,1);} }return nh;});setAF(f=>[m,...f]);addLog(`AI合成${m.name}`);const dmg=used.reduce((s,el)=>s+(ELEMENTS.indexOf(el)+1),0);setP(h=>Math.max(0,h-dmg));addLog(`玩家受${dmg}傷`);}else addLog('AI跳過');endTurn();},2000);},[turn]);
  const possibleList=React.useMemo(()=>{const cnt={};pHand.forEach(c=>{if(c&&c.el)cnt[c.el]=(cnt[c.el]||0)+1;});return MOLECULES.filter(m=>Object.entries(m.formula).every(([el,n])=>cnt[el]>=n)).map(m=>{const parts=Object.entries(m.formula).map(([el,n])=>n>1?`${n}${el}`:el);return `${m.name} (${parts.join(' + ')})`;});},[pHand]);

  return(
    <div className="game-container"><div className="board">
      <h1>化學卡牌對戰</h1>
      {gameOver&&<div className="overlay"><h2>{gameOver==='win'?'你贏了':'化學不會就是不會'}</h2><button onClick={resetGame}>重新開始</button></div>}
      <div className="hp-section"><span className="hp-label">AI HP</span><div className="hp-bar"><div className="hp-inner" style={{width:`${aHP/MAX_HP*100}%`}}/></div><span>{aHP}</span></div>
      <div className="zone"><div className="zone-title">對手分子區</div><div className="field">{aField.map((m,i)=><div key={i} className={`card molecule ${m.effect}`}><div>{m.name}</div></div>)}</div></div>
      <div className="zone"><div className="zone-title">我方分子區</div><div className="field">{pField.map((m,i)=><div key={i} className={`card molecule ${m.effect}`}><div>{m.name}</div></div>)}</div></div>
      <div className="zone"><div className="zone-title">玩家手牌</div><div className="hand">{pHand.map((c,i)=><div key={i} className={`card element${sel.includes(i)?' selected':''}`} onClick={()=>onSelect(i)}><div className="symbol">{c.el}</div><div className="number">{ELEMENTS.indexOf(c.el)+1}</div></div>)}</div></div>
      <div className="prompt">
          {possibleList.length > 0
            ? `可合成: ${possibleList.join('、')}`
            : '無可合成化合物'}
        </div>
      <div className="hp-section"><span className="hp-label">玩家 HP</span><div className="hp-bar"><div className="hp-inner" style={{width:`${pHP/MAX_HP*100}%`}}/></div><span>{pHP}</span></div>
      <div className="controls"><button onClick={combine} disabled={turn!=='player'||gameOver}>合成</button><button onClick={discard} disabled={turn!=='player'||sel.length===0||gameOver}>棄牌</button><button onClick={endTurn} disabled={turn!=='player'||gameOver}>結束回合</button></div>
      <div className="log">{log.map((l,i)=><div key={i}>{l}</div>)}</div>
    </div></div>
  );
}
ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
